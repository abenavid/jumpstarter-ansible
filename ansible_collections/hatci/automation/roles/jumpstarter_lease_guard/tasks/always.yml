---
# Always tasks for jumpstarter_lease_guard role
# These tasks run even if the main block fails

- name: Release Jumpstarter lease (always)
  jumpstarter.jumpstarter.jumpstarter_lease:
    state: release
    lease_name: "{{ current_lease_name | default('') }}"
    client_config: "{{ jumpstarter_client_config | default(omit) }}"
    client: "{{ jumpstarter_client | default(omit) }}"
  when: current_lease_name is defined and current_lease_name != ""
  failed_when: false
  register: release_result

- name: Log lease release result
  ansible.builtin.debug:
    msg: "Lease {{ current_lease_name | default('unknown') }} release result: {{ release_result.changed | default(false) }}"
